<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css"> 
    <link rel="stylesheet" href="material.css"> 
</head>
<body>
    <div class="left-navbar" id="leftNavbar">
        <a href="#" class="active"><i class="fas fa-home"></i> <span>Dashboard</span></a>
        <a href="#"><i class="fas fa-credit-card"></i> <span>Πληρωμές</span></a>
        <a href="#"><i class="fas fa-undo"></i> <span>Επιστροφές</span></a>
    </div>
    
    <div class="main-container">
        <div class="top-bar">
            <div class="search-bar">
                <input type="text" placeholder="Search..." id="generalSearch">
            </div>
            <div class="notification-icon">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </div>
        </div>
        
        <div class="search-filter">
            <input type="text" placeholder="Αναζήτηση Πελάτη" id="customerSearch">
            <select id="productFilter">
                <option value="">Φίλτρο Προϊόντων</option>
            </select>
            <select id="paymentFilter">
                <option value="">Μέθοδος πληρωμής</option>
            </select>
        </div>
        
        <table id="data-table">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Name</th>
                    <th>Order Number</th>
                    <th>Products</th>
                    <!-- <th>Date</th> -->
                    <th>Amount</th>
                    <th>Payment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('details-modal')">&times;</span>
            <div id="details-modal-text"></div>
        </div>
    </div>

    <!-- Completion Confirmation Modal -->
    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('completion-modal')">&times;</span>
            <h2>Επιβεβαίωση Ολοκλήρωσης</h2>
            <p>Είστε σίγουροι ότι ολοκληρώθηκε η παραγγελία;</p>
            <div class="modal-buttons">
                <button class="button secondary" onclick="confirmCompletion()">Ναι</button>
                <button class="button primary" onclick="closeModal('completion-modal')">Όχι</button>
            </div>
        </div>
    </div>

    <script>
        // JSON data from WooCommerce API
        const apiResponse = [
            {
                "id": 1234,
                "billing": {
                    "first_name": "John",
                    "last_name": "Doe",
                    "address_1": "123 Main St",
                    "city": "New York",
                    "postcode": "10001",
                    "phone": "(555) 555-5555",
                    "email": "john.doe@example.com"
                },
                "customer_note": "Παράδοση μετά τις 3μμ",
                "payment_method": "paypal",
                "total": "45.00",
                "line_items": [
                    {
                        "name": "Σαπούνι Ελιάς",
                        "quantity": 1
                    },
                    {
                        "name": "Αντιηλιακή Κρέμα",
                        "quantity": 2
                    }
                ]
            },
            {
                "id": 1235,
                "billing": {
                    "first_name": "Maria",
                    "last_name": "Konstantinou",
                    "address_1": "Εγνατία 112",
                    "city": "Θεσσαλονίκη",
                    "postcode": "54635",
                    "phone": "2310123456",
                    "email": "maria.konstantinou@example.com"
                },
                "customer_note": "",
                "payment_method": "Μετρητά",
                "total": "28.75",
                "line_items": [
                    {
                        "name": "Σαμπουάν",
                        "quantity": 1
                    },
                    {
                        "name": "Αφρόλουτρο",
                        "quantity": 1
                    },
                    {
                        "name": "Οδοντόκρεμα",
                        "quantity": 1
                    }
                ]
            },
            {
                "id": 1235,
                "billing": {
                    "first_name": "Ανδρεας",
                    "last_name": "Μούτσης",
                    "address_1": "Εγνατία 112",
                    "city": "Αθήνα",
                    "postcode": "54635",
                    "phone": "2310123456",
                    "email": "maria.konstantinou@example.com"
                },
                "customer_note": "",
                "payment_method": "Μετρητά",
                "total": "28.75",
                "line_items": [
                    {
                        "name": "Σαμπουάν",
                        "quantity": 1
                    },
                    {
                        "name": "Αφρόλουτρο",
                        "quantity": 1
                    },
                    {
                        "name": "Οδοντόκρεμα",
                        "quantity": 1
                    }
                ]
            },
            {
                "id": 1235,
                "billing": {
                    "first_name": "Τάνια",
                    "last_name": "Μασέλη",
                    "address_1": "Εγνατία 112",
                    "city": "Αθήνα",
                    "postcode": "54635",
                    "phone": "2310123456",
                    "email": "maria.konstantinou@example.com"
                },
                "customer_note": "",
                "payment_method": "Μετρητά",
                "total": "28.75",
                "line_items": [
                    {
                        "name": "Σαμπουάν",
                        "quantity": 1
                    },
                    {
                        "name": "Αφρόλουτρο",
                        "quantity": 1
                    },
                    {
                        "name": "Οδοντόκρεμα",
                        "quantity": 1
                    }
                ]
            }
        ];
    
        // Process API data to match your structure
        const orders = apiResponse.map(order => ({
            orderNumber: order.id,
            customerName: `${order.billing.first_name} ${order.billing.last_name}`,
            address: order.billing.address_1,
            area: order.billing.city,
            zip: order.billing.postcode,
            phone: order.billing.phone,
            email: order.billing.email,
            comments: order.customer_note || "Χωρίς παρατηρήσεις",
            paymentMethod: order.payment_method === 'paypal' ? 'PayPal' : order.payment_method,
            amount: order.total,
            products: order.line_items.map(item => `${item.name} (x${item.quantity})`),
            productNames: order.line_items.map(item => item.name) // Only product names for filtering
        }));
    
        // Populate the table
        let filteredOrders = [...orders];
    
        function populateTable(ordersToShow) {
            const tableBody = document.querySelector('#data-table tbody');
            tableBody.innerHTML = '';
            ordersToShow.forEach((order, index) => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${order.customerName}</td>
                    <td>${order.orderNumber}</td>
                    <td>${order.products.join(', ')}</td>
                    <td>${order.amount}</td>
                    <td>${order.paymentMethod}</td>
                    <td>
                        <button class="button primary" onclick="showDetails(${index})">Details</button>
                        <button class="button secondary" onclick="showCompletionModal(${index})">Ολοκλήρωση</button>
                    </td>
                `;
            });
        }
    
        function showDetails(index) {
            const modal = document.getElementById('details-modal');
            const modalText = document.getElementById('details-modal-text');
            const order = filteredOrders[index];
            modalText.innerHTML = `
                <h2>Order Details</h2>
                <p><strong>Name:</strong> ${order.customerName}</p>
                <p><strong>Order Number:</strong> ${order.orderNumber}</p>
                <p><strong>Address:</strong> ${order.address}, ${order.area}, ${order.zip}</p>
                <p><strong>Phone:</strong> ${order.phone}</p>
                <p><strong>Email:</strong> ${order.email}</p>
                <p><strong>Products:</strong> ${order.products.join(', ')}</p>
                <p><strong>Amount:</strong> ${order.amount}</p>
                <p><strong>Payment Method:</strong> ${order.paymentMethod}</p>
                <p><strong>Comments:</strong> ${order.comments}</p>
            `;
            modal.style.display = 'block';
        }

        function showCompletionModal(index) {
            const modal = document.getElementById('completion-modal');
            modal.setAttribute('data-order-index', index);
            modal.style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function confirmCompletion() {
            const modal = document.getElementById('completion-modal');
            const orderIndex = modal.getAttribute('data-order-index');
            // Implement the order completion logic here, e.g., API call to update order status
            console.log(`Order ${filteredOrders[orderIndex].orderNumber} completed.`);
            closeModal('completion-modal');
        }

        function populateFilters() {
            const productFilter = document.getElementById('productFilter');
            const paymentFilter = document.getElementById('paymentFilter');

            const productNames = [...new Set(filteredOrders.flatMap(order => order.productNames))];
            const paymentMethods = [...new Set(filteredOrders.map(order => order.paymentMethod))];

            productFilter.innerHTML = '<option value="">Φίλτρο Προϊόντων</option>';
            paymentFilter.innerHTML = '<option value="">Μέθοδος πληρωμής</option>';

            productNames.forEach(name => {
                productFilter.innerHTML += `<option value="${name}">${name}</option>`;
            });

            paymentMethods.forEach(method => {
                paymentFilter.innerHTML += `<option value="${method}">${method}</option>`;
            });
        }
    
        function filterData() {
            const customerSearch = document.getElementById('customerSearch').value.toLowerCase();
            const productFilter = document.getElementById('productFilter').value;
            const paymentFilter = document.getElementById('paymentFilter').value;

            filteredOrders = orders.filter(order => {
                const matchesCustomer = order.customerName.toLowerCase().includes(customerSearch);
                const matchesProduct = productFilter ? order.productNames.includes(productFilter) : true;
                const matchesPayment = paymentFilter ? order.paymentMethod === paymentFilter : true;
                return matchesCustomer && matchesProduct && matchesPayment;
            });

            populateTable(filteredOrders);
        }

        document.getElementById('customerSearch').addEventListener('input', filterData);
        document.getElementById('productFilter').addEventListener('change', filterData);
        document.getElementById('paymentFilter').addEventListener('change', filterData);

        document.addEventListener('DOMContentLoaded', () => {
            populateTable(filteredOrders);
            populateFilters();
        });
    </script>
</body>
</html>
